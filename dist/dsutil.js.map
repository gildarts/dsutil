{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./index.ts","webpack:///./src/access_point.ts","webpack:///./src/connection.ts","webpack:///./src/converter.ts","webpack:///./src/dsa_http_client.ts","webpack:///./src/dsns.ts","webpack:///./src/envelope.ts","webpack:///./src/errors.ts","webpack:///./src/http_client.ts","webpack:///./src/secure_tunnel.ts","webpack:///./src/xelement.ts","webpack:///external \"crypto\"","webpack:///external \"got\"","webpack:///external \"xml-js\""],"names":[],"mappings":"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","file":"dsutil.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./index.ts\");\n","export * from './src/access_point';\nexport * from './src/connection';\nexport * from './src/dsns';\nexport * from './src/envelope';\nexport * from './src/http_client';","import { resolveDSNS } from \"./dsns\";\n\nexport class AccessPoint {\n\n    public constructor(\n        public readonly applicationUrl: string,\n        public readonly contract: string,\n        public readonly dsns?: string,\n    ) {}\n\n    public toString() {\n        if(this.applicationUrl.endsWith('/')) {\n            return `${this.applicationUrl}${this.contract}`;\n        } else {\n            return `${this.applicationUrl}/${this.contract}`;\n        }\n    }\n\n    /** 解析 dsns，如果為 http 開頭，則不會呼叫 dsns server，而是直接建立 AccessPoint 物件。 */\n    public static async resolve(dsns: string, contract: string, timeoutMs: number = 5000) {\n        if(dsns.startsWith('http')) {\n            return new AccessPoint(dsns, contract);\n        } else {\n            const url = await resolveDSNS(dsns, timeoutMs);\n            return new AccessPoint(url!, contract, dsns);\n        }\n    }\n\n    /** 解析 url 分離 dsns 與 contract。 */\n    public static parse(url: string) {\n        const fragments =  url.split('/');\n\n        let contract;\n\n        // 去除一些空白的陣列元件。\n        while(!(contract = fragments.pop()) && fragments.length > 0) { }\n\n        return new AccessPoint(fragments.join('/'), contract!);\n    }\n}\n","import { Envelope, SessionSecurityToken } from './envelope';\nimport type { SecurityToken } from './envelope';\nimport type { AccessPoint } from './access_point';\nimport { DSAHttpClient } from './dsa_http_client';\nimport type { XElement } from './xelement';\nimport { DSAError } from './errors';\nimport { SecureTunnelService, SecureTunnel } from './secure_tunnel';\n\nexport const ConnectService = 'DS.Base.Connect';\n\nexport class Connection {\n\n    private session!: SecurityToken;\n\n    private version!: string;\n\n    private create_at: Date;\n\n    /** 安全通道服務（用於加密通訊） */\n    private secureTunnelService: SecureTunnelService | null = null;\n\n    constructor(\n        public readonly accessPoint: AccessPoint,\n        private readonly securityToken: SecurityToken\n    ) {\n        this.create_at = new Date();\n    }\n\n    public get createAt() { return this.create_at; }\n\n    public async connect(): Promise<Connection> {\n\n        if(this.securityToken instanceof SessionSecurityToken) {\n            this.session = this.securityToken;\n            return this;\n        }\n\n        if(!this.useSession) return this;\n\n        const { applicationUrl, contract } = this.accessPoint;\n\n        // 如果啟用安全通道，先初始化\n        if (this.enableSecureTunnel) {\n            this.secureTunnelService = new SecureTunnelService();\n            await this.secureTunnelService.init(applicationUrl, contract, this.timeout);\n        }\n\n        const envelope = new Envelope();\n        envelope.targetContract = contract;\n        envelope.targetService = ConnectService;\n        envelope.credential = this.securityToken;\n        envelope.setBody('<RequestSessionID />');\n\n        // 發送請求（可能經過加密）\n        const rsp = await this.sendRaw(applicationUrl, contract, envelope.toString());\n\n        let rspenv;\n        try {\n            rspenv = new Envelope(rsp);\n        } catch (err: any) {\n            // 如果是 XML 解析錯誤，把原始回應內容包進錯誤訊息\n            if (err.message?.includes(\"Unexpected\") || err.message?.includes(\"sax\")) {\n                const preview = rsp?.substring(0, 1000) || \"(empty)\";\n                throw new Error(`XML 解析失敗，可能回傳了非 XML 內容:\\n${preview}`);\n            }\n            throw err;\n        }\n\n        if(rspenv.code !== '0') {\n            throw new DSAError(rspenv.message, rspenv.code);\n        }\n\n        const rspbody = rspenv.getBody();\n        const sessionId = rspbody.child('SessionID').text\n\n        if(!sessionId) {\n            throw new Error('Session Not Supported.');\n        }\n\n        this.session = new SessionSecurityToken({ SessionID: sessionId });\n        this.version = rspenv.header('Version').text;\n\n        return this;\n    }\n\n    /**\n     * 發送原始請求（處理加密/解密）\n     */\n    private async sendRaw(url: string, contract: string, envelopeXml: string): Promise<string> {\n        let requestBody = envelopeXml;\n        let tunnel: SecureTunnel | null = null;\n\n        // 如果啟用安全通道，加密請求\n        if (this.enableSecureTunnel && this.secureTunnelService) {\n            tunnel = this.secureTunnelService.newTunnel();\n            requestBody = tunnel.protect(envelopeXml, contract);\n        }\n\n        const rsp = await DSAHttpClient.post(url, requestBody, this.timeout);\n\n        if (!rsp?.body) {\n            throw new Error('伺服器無回應');\n        }\n\n        // 如果有使用加密，解密回應\n        if (tunnel) {\n            return tunnel.unprotect(rsp.body);\n        }\n\n        return rsp.body;\n    }\n\n    public getSession() {\n        return this.session;\n    }\n\n    /** 取得 DSA 的核心版本。 */\n    public getVersion() {\n        return this.version;\n    }\n\n    /** 是否使用 session 機制。 */\n    public useSession: boolean = true;\n\n    /** 請求超時設定（毫秒）。 */\n    public timeout: number = 5000;\n\n    /** 是否啟用安全通道（RSA 混合加密）。 */\n    public enableSecureTunnel: boolean = true;\n\n    /**\n     *\n     * @param service 服務名稱。\n     * @param body Xml 字串、Json 物件或是 Jsonx 物件。\n     * @returns\n     */\n    public async send(service: string, body?: string | XElement | any) {\n        const { applicationUrl, contract } = this.accessPoint;\n\n        const envelope = new Envelope();\n        envelope.targetContract = contract;\n        envelope.targetService = service;\n\n        if(this.useSession) {\n            envelope.credential = this.session;\n        } else {\n            envelope.credential = this.securityToken;\n        }\n\n        envelope.setBody(body);\n\n        // 發送請求（可能經過加密）\n        const rsp = await this.sendRaw(applicationUrl, contract, envelope.toString());\n\n        let rspenv;\n        try {\n            rspenv = new Envelope(rsp);\n        } catch (err: any) {\n            // 如果是 XML 解析錯誤，把原始回應內容包進錯誤訊息\n            if (err.message?.includes(\"Unexpected\") || err.message?.includes(\"sax\")) {\n                const preview = rsp?.substring(0, 1000) || \"(empty)\";\n                throw new Error(`XML 解析失敗，可能回傳了非 XML 內容:\\n${preview}`);\n            }\n            throw err;\n        }\n\n        if(rspenv.code !== '0') {\n            throw new DSAError(rspenv.message, rspenv.code, rspenv.getBody().toXmlString());\n        }\n\n        return rspenv.getBody();\n    }\n}\n","import { js2xml, xml2js } from 'xml-js';\nimport type { ElementCompact } from 'xml-js';\n\nexport function toJson(xmlString: string): ElementCompact {\n    return xml2js(xmlString, { compact: true });\n}\n\nexport function toXml(jsonObj: ElementCompact, rootName?: string) {\n\n    if (rootName) {\n        const root: any = {};\n        root[rootName] = jsonObj;\n        return js2xml(root, { compact: true, spaces: 4 });\n    } else {\n        return js2xml(jsonObj, { compact: true, spaces: 4 });\n    }\n}\n","export class DSAHttpClient {\n\n  public static async post(url: string, xmlString?: string, timeoutMs: number = 5000) {\n    try {\n      // 使用 Promise.race 強制 timeout（因為 Bun 的 AbortSignal 在連線失敗時不會生效）\n      const fetchPromise = fetch(url, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'text/xml'\n        },\n        body: xmlString\n      }).then(r => r.text());\n\n      const timeoutPromise = new Promise<never>((_, reject) =>\n        setTimeout(() => reject(new Error('TIMEOUT')), timeoutMs)\n      );\n\n      const xmlStrRsp = await Promise.race([fetchPromise, timeoutPromise]);\n      return { body: xmlStrRsp };\n    } catch (error: any) {\n      if (error.message === 'TIMEOUT') {\n        throw new Error(`Request timeout after ${timeoutMs}ms`);\n      }\n      console.log('fetch 炸了！fetch 炸了！fetch 炸了！fetch 炸了！fetch 炸了！fetch 炸了！fetch 炸了！')\n      console.error(error);\n      throw error;\n    }\n  }\n\n  public static async get(url: string, timeoutMs: number = 5000) {\n    try {\n      // 使用 Promise.race 強制 timeout\n      const fetchPromise = fetch(url).then(r => r.text());\n      const timeoutPromise = new Promise<never>((_, reject) =>\n        setTimeout(() => reject(new Error('TIMEOUT')), timeoutMs)\n      );\n\n      const rsp = await Promise.race([fetchPromise, timeoutPromise]);\n      return { body: rsp };\n    } catch (error: any) {\n      if (error.message === 'TIMEOUT') {\n        throw new Error(`Request timeout after ${timeoutMs}ms`);\n      }\n      throw error;\n    }\n  }\n}\n","import { DSAHttpClient } from \"./dsa_http_client\";\n\nconst localMap = new Map<string, string>();\n\nexport const DSNS = 'https://dsns.ischool.com.tw';\n\n/** 註冊本地端 DSNS */\nexport function registerLocal(dsns: string, url: string) {\n    localMap.set(dsns, url);\n}\n\nexport async function resolveDSNS(dsns: string, timeoutMs: number = 10000) {\n\n    // 如果本地端有註冊就直接回傳。\n    if (localMap.has(dsns)) { return localMap.get(dsns); }\n\n    const rsp = await DSAHttpClient.get(`${DSNS}/${dsns}?noredirect`, timeoutMs);\n    //console.log('dsns rsp', rsp);\n    if(rsp.body!.indexOf('Exception') >= 0) {\n        throw new Error(`DSNS Not Found(${dsns}).`);\n    }\n\n    return rsp.body!.replace('?noredirect', '');\n}\n","import type { ElementCompact } from 'xml-js';\nimport { toJson } from './converter';\nimport { XElement } from './xelement';\n\nconst RootName = \"Envelope\";\nconst HeaderName = 'Header';\nconst BodyName = 'Body';\n\nexport class Envelope {\n\n    private envelope: XElement;\n\n    private m_header: XElement;\n\n    private m_security_token!: SecurityToken;\n\n    constructor(xml: string = `<${RootName}/>`) {\n\n        const root = new XElement(xml);\n        if (!root.exists(RootName)) {\n            throw new Error('根必須是 Envelop。')\n        }\n\n        this.envelope = root.child(RootName)\n        this.m_header = this.envelope.child(HeaderName);\n    }\n\n    public get targetContract() {\n        return this.m_header.child('TargetContract').text;\n    }\n\n    public set targetContract(val: string) {\n        this.m_header.child('TargetContract').text = val;\n    }\n\n    public get targetService() {\n        return this.m_header.child('TargetService').text;\n    }\n\n    public set targetService(val: string) {\n        this.m_header.child('TargetService').text = val;\n    }\n\n    public get code() {\n        const pos = ['Status', 'Code'];\n\n        if(this.m_header.exists(...pos)) {\n            return this.m_header.child(...pos).text;\n        }\n\n        return '';\n    }\n\n    public get message() {\n        const pos = ['Status', 'Message'];\n\n        if(this.m_header.exists(...pos)) {\n            return this.m_header.child(...pos).text;\n        }\n\n        return '';\n    }\n\n    public get credential() {\n        return this.m_security_token;\n    }\n\n    public set credential(val: SecurityToken) {\n        this.m_security_token = val;\n    }\n\n    public header(...name: string[]) {\n        return this.m_header.child(...name);\n    }\n\n    public getBody() {\n        return this.envelope.child(BodyName);\n    }\n\n    public setBody(content: string | XElement | any) {\n        this.envelope.raw(BodyName, content);\n    }\n\n    public toString() {\n        if(this.credential) {\n            this.m_header.raw(SecurityToken.Name, this.credential.data);\n        }\n\n        return this.envelope.toXmlString(RootName);\n    }\n}\n\nexport class SecurityToken {\n\n    public static readonly Name = 'SecurityToken';\n\n    public data: XElement;\n\n    constructor(secrets: ElementCompact | XElement = new XElement()) {\n\n        if (!(secrets instanceof XElement)) {\n            this.data = new XElement(secrets);\n        } else {\n            this.data = secrets;\n        }\n    }\n\n    public get type() {\n        return this.data.getAttr('Type');\n    }\n}\n\nexport class PublicSecurityToken extends SecurityToken {\n\n    constructor() {\n        super();\n\n        this.data.setAttr('Type', 'Public');\n    }\n}\n\nexport class SessionSecurityToken extends SecurityToken {\n\n    constructor(secrets: { SessionID: string }) {\n        super({ SessionID: { _text: secrets.SessionID } });\n\n        this.data.setAttr('Type', 'Session');\n    }\n\n    public get sessionId() {\n        return this.data.child('SessionID').text;\n    }\n\n    public set sessionId(val: string) {\n        this.data.child('SessionID').text = val;\n    }\n}\n\nexport class BasicSecurityToken extends SecurityToken {\n\n    constructor(secrets: { UserName: string, Password: string }) {\n        super({\n            UserName: { _text: secrets.UserName },\n            Password: { _text: secrets.Password }\n        });\n        this.data.setAttr('Type', 'Basic');\n    }\n\n    public get userName() {\n        return this.data.child('UserName').text;\n    }\n\n    public set userName(val: string) {\n        this.data.child('UserName').text = val;\n    }\n\n    public get password() {\n        return this.data.child('Password').text;\n    }\n\n    public set password(val: string) {\n        this.data.child('Password').text = val;\n    }\n}\n\nexport class PassportSecurityToken extends SecurityToken{\n\n    constructor(passportXml: string) {\n        super(toJson(passportXml));\n        this.data.setAttr('Type', 'Passport');\n    }\n}\n\nexport class PassportAccessToken extends SecurityToken {\n    constructor(secrets: { AccessToken: string }) {\n        super({ AccessToken: { _text: secrets.AccessToken } });\n\n        this.data.setAttr('Type', 'PassportAccessToken');\n    }\n\n    public get accessToken() {\n        return this.data.child('AccessToken').text;\n    }\n\n    public set accessToken(val: string) {\n        this.data.child('AccessToken').text = val;\n    }\n}\n","export class DSAError extends Error {\n    constructor(\n        message: string,\n        public readonly code: string,\n        public readonly detail?: any\n    ) {\n        super(message);\n        this.name = 'DSAError';\n    }\n}\n","import got from 'got';\n\nexport class HttpClient {\n\n    public static async post(url: string, body?: string, options?: { followRedirect: boolean }) {\n        \n        const rsp = await got.post(url, {\n            ...options,\n            body: body\n        });\n\n        return { body: rsp.body };\n    }\n\n    public static async get(url: string, options?: { followRedirect: boolean }) {\n        const rsp = await got.get(url, options);\n        return { body: rsp.body, header: rsp.headers };\n    }\n}\n\n// const url = 'http://devg.ischool.com.tw:8080/dsa/dev.sh_d/admin/UDSManagerService.ExportContract?stt=basic&username=admin&password=1campus12%23%24&body=%3CRequest%3E%20%3CContractName%3E1campus.mobile.v2.student%3C/ContractName%3E%3C/Request%3E';\n\n// HttpClient.get(url).then(rsp => {\n//     console.log(rsp);\n// });\n\n// const body = `\n// <Envelope>\n// \t<Header>\n// \t\t<TargetService>UDSManagerService.ExportContract</TargetService>\n// \t\t<TargetContract>admin</TargetContract>\n// \t\t<SecurityToken Type=\"Basic\">\n//             <UserName>admin</UserName>\n//             <Password>1campus12#$</Password>\n// \t\t</SecurityToken>\n// \t</Header>\n// \t<Body>\n// \t\t<Request>\n// \t\t\t<ContractName>1campus.mobile.v2.student</ContractName>\n// \t\t</Request>\n// \t</Body>\n// </Envelope>\n// `\n\n// HttpClient.post(\"http://devg.ischool.com.tw:8080/dsa/dev.sh_d\", body).then(rsp => {\n//     console.log(rsp);\n// }, err => {\n//     console.log(err);\n// })\n","/**\n * DSA Secure Tunnel - RSA 混合加密通道\n *\n * 移植自 C# FISCA.DSAClient.SecureTunnel\n *\n * 加密流程：\n * 1. 產生隨機 SecretKey (GUID)\n * 2. 用 MD5 將 GUID 轉成 16 bytes 作為 AES Key\n * 3. 用 Server 公鑰 RSA 加密 SecretKey\n * 4. 用 AES 加密原始 Envelope\n * 5. 組合成 CryptoToken 格式發送\n *\n * 解密流程：\n * 1. 從回應取出 CryptoToken/Cipher\n * 2. 用同一個 AES Key 解密\n */\n\nimport crypto from \"crypto\";\nimport { DSAHttpClient } from \"./dsa_http_client.ts\";\n\n// === 工具函數 ===\n\n/**\n * 從 XML 格式的 RSA 公鑰提取 Modulus 和 Exponent\n */\nfunction parseRsaXmlKey(xml: string): { modulus: Buffer; exponent: Buffer } {\n  const modulusMatch: any = xml.match(/<Modulus>([^<]+)<\\/Modulus>/);\n  const exponentMatch: any = xml.match(/<Exponent>([^<]+)<\\/Exponent>/);\n\n  if (!modulusMatch || !exponentMatch) {\n    throw new Error(\"無法解析 RSA XML 公鑰\");\n  }\n\n  return {\n    modulus: Buffer.from(modulusMatch[1], \"base64\"),\n    exponent: Buffer.from(exponentMatch[1], \"base64\"),\n  };\n}\n\n/**\n * 將 RSA XML 公鑰轉成 Node.js crypto 可用的 KeyObject\n */\nfunction xmlKeyToPublicKey(xml: string): crypto.KeyObject {\n  const { modulus, exponent } = parseRsaXmlKey(xml);\n\n  // 轉成 JWK 格式\n  const jwk = {\n    kty: \"RSA\",\n    n: modulus.toString(\"base64url\"),\n    e: exponent.toString(\"base64url\"),\n  };\n\n  return crypto.createPublicKey({ key: jwk, format: \"jwk\" });\n}\n\n/**\n * 將密碼字串用 MD5 轉成 16 bytes 的 AES Key\n */\nfunction md5Password(password: string): Buffer {\n  return crypto.createHash(\"md5\").update(password, \"utf8\").digest();\n}\n\n/**\n * AES-128-ECB 加密（PKCS7 padding）\n */\nfunction aesEncrypt(plaintext: string, key: Buffer): string {\n  const cipher = crypto.createCipheriv(\"aes-128-ecb\", key, null);\n  cipher.setAutoPadding(true);\n  const encrypted = Buffer.concat([cipher.update(plaintext, \"utf8\"), cipher.final()]);\n  return encrypted.toString(\"base64\");\n}\n\n/**\n * AES-128-ECB 解密（PKCS7 padding）\n */\nfunction aesDecrypt(ciphertext: string, key: Buffer): string {\n  const decipher = crypto.createDecipheriv(\"aes-128-ecb\", key, null);\n  decipher.setAutoPadding(true);\n  const decrypted = Buffer.concat([decipher.update(ciphertext, \"base64\"), decipher.final()]);\n  return decrypted.toString(\"utf8\");\n}\n\n/**\n * 用 Server 公鑰 RSA 加密\n */\nfunction rsaEncrypt(plaintext: string, publicKey: crypto.KeyObject): string {\n  const encrypted = crypto.publicEncrypt(\n    {\n      key: publicKey,\n      padding: crypto.constants.RSA_PKCS1_PADDING,\n    },\n    Buffer.from(plaintext, \"utf8\")\n  );\n  return encrypted.toString(\"base64\");\n}\n\n/**\n * 產生 Client 的 RSA KeyPair\n */\nfunction generateClientKeyPair(): { privateKey: crypto.KeyObject; publicKeyXml: string } {\n  const { privateKey, publicKey } = crypto.generateKeyPairSync(\"rsa\", {\n    modulusLength: 1024,\n  });\n\n  // 將公鑰轉成 C# 的 XML 格式\n  const jwk = publicKey.export({ format: \"jwk\" }) as { n: string; e: string };\n  const modulus = Buffer.from(jwk.n, \"base64url\").toString(\"base64\");\n  const exponent = Buffer.from(jwk.e, \"base64url\").toString(\"base64\");\n  const publicKeyXml = `<RSAKeyValue><Modulus>${modulus}</Modulus><Exponent>${exponent}</Exponent></RSAKeyValue>`;\n\n  return { privateKey, publicKeyXml };\n}\n\n// === SecureTunnel 類別 ===\n\n/**\n * 安全通道 - 處理單次請求的加解密\n */\nexport class SecureTunnel {\n  private secretKeyString: string;\n  private aesKey: Buffer;\n  private serverPublicKey: crypto.KeyObject;\n  private clientPublicKeyXml: string;\n\n  constructor(serverPublicKey: crypto.KeyObject) {\n    this.serverPublicKey = serverPublicKey;\n    this.secretKeyString = crypto.randomUUID();\n    this.aesKey = md5Password(this.secretKeyString);\n\n    const { publicKeyXml } = generateClientKeyPair();\n    this.clientPublicKeyXml = publicKeyXml;\n  }\n\n  /**\n   * 加密 Envelope\n   * @param envelope 原始 Envelope XML 字串\n   * @param targetContract 目標 Contract（會保留在外層）\n   * @returns 加密後的 Envelope XML 字串\n   */\n  protect(envelope: string, targetContract: string): string {\n    // RSA 加密 SecretKey\n    const cipherSecretKey = rsaEncrypt(this.secretKeyString, this.serverPublicKey);\n\n    // AES 加密 Client PublicKey\n    const cipherPublicKey = aesEncrypt(this.clientPublicKeyXml, this.aesKey);\n\n    // AES 加密原始 Envelope\n    const cipherContent = aesEncrypt(envelope, this.aesKey);\n\n    // 組合加密後的 Envelope\n    return `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<Envelope>\n<Header>\n<TargetContract>${targetContract}</TargetContract>\n<CryptoToken Type=\"Static\">\n<SecretKey>${cipherSecretKey}</SecretKey>\n<PublicKey>${cipherPublicKey}</PublicKey>\n<Cipher>${cipherContent}</Cipher>\n</CryptoToken>\n</Header>\n<Body/>\n</Envelope>`;\n  }\n\n  /**\n   * 解密 Envelope\n   * @param encryptedEnvelope 加密的 Envelope XML 字串\n   * @returns 解密後的 Envelope XML 字串\n   */\n  unprotect(encryptedEnvelope: string): string {\n    const cipherMatch: any = encryptedEnvelope.match(/<Cipher>([^<]+)<\\/Cipher>/);\n    if (!cipherMatch) {\n      // 沒有 CryptoToken，可能是明文錯誤回應，直接返回\n      return encryptedEnvelope;\n    }\n\n    return aesDecrypt(cipherMatch[1], this.aesKey);\n  }\n}\n\n// === SecureTunnelService 類別 ===\n\n/**\n * 安全通道服務 - 管理與特定 Contract 的加密通道\n */\nexport class SecureTunnelService {\n  private serverPublicKey: crypto.KeyObject | null = null;\n  private accessPointUrl: string = \"\";\n  private targetContract: string = \"\";\n\n  /**\n   * 初始化安全通道服務\n   * @param accessPointUrl DSA 存取點 URL\n   * @param targetContract 目標 Contract\n   * @param timeout 超時時間（毫秒）\n   */\n  async init(accessPointUrl: string, targetContract: string, timeout: number = 5000): Promise<void> {\n    this.accessPointUrl = accessPointUrl;\n    this.targetContract = targetContract;\n\n    // 呼叫 Public.GetPublicKey 取得 Server 公鑰\n    const requestBody = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<Envelope>\n<Header>\n<TargetContract>info</TargetContract>\n<TargetService>Public.GetPublicKey</TargetService>\n</Header>\n<Body>\n<Content>\n<Contract>${targetContract}</Contract>\n<Format>pkcs8</Format>\n</Content>\n</Body>\n</Envelope>`;\n\n    const response = await DSAHttpClient.post(accessPointUrl, requestBody, timeout);\n\n    if (!response?.body) {\n      throw new Error(\"取得 Server 公鑰失敗：無回應\");\n    }\n\n    // 檢查是否是錯誤回應\n    if (response.body.includes(\"<Status>\") || response.body.includes(\"<Code>\")) {\n      throw new Error(`取得 Server 公鑰失敗：${response.body}`);\n    }\n\n    // 解析公鑰\n    this.serverPublicKey = xmlKeyToPublicKey(response.body);\n  }\n\n  /**\n   * 建立新的安全通道\n   */\n  newTunnel(): SecureTunnel {\n    if (!this.serverPublicKey) {\n      throw new Error(\"SecureTunnelService 尚未初始化，請先呼叫 init()\");\n    }\n    return new SecureTunnel(this.serverPublicKey);\n  }\n\n  /**\n   * 取得目標 Contract\n   */\n  getTargetContract(): string {\n    return this.targetContract;\n  }\n}\n","import type { ElementCompact } from \"xml-js\";\nimport { toJson, toXml } from \"./converter\";\n\n/** 提供以 Xml 概念操作 JSON 結構。 */\nexport class XElement implements Iterable<XElement> {\n\n    public static parse(xml: string) {\n        const root = `<__root>${xml}</__root>`\n        return new XElement(toJson(root)['__root']);\n    }\n\n    /** 原始資料。 */\n    public readonly data: ElementCompact | ElementCompact[] | any;\n\n    /**\n     * 建立物件從 xml 字串或是 ElementCompact。\n     */\n    constructor(content: string | ElementCompact | ElementCompact[] = {}) {\n        if (typeof(content) === 'string') {\n            const root = `<__root>${content}</__root>`\n            this.data =  toJson(root)['__root'];\n        } else {\n            this.data = content;\n        }\n    }\n\n    /**\n     * 讀取或設定文字內容。\n     */\n    public get text() {\n        this.checkNotArray();\n        const val = (this.data as ElementCompact)._text;\n\n        return (val ?? null) as any;\n    }\n\n    public set text(val: string) {\n        this.checkNotArray();\n        (this.data as ElementCompact)._text = val;\n    }\n\n    /** 讀取或寫入 CDATASection 資料。 */\n    public get cdata() {\n        this.checkNotArray();\n        return (this.data as ElementCompact)._cdata;\n    }\n\n    public set cdata(val: string | undefined) {\n        this.checkNotArray();\n        (this.data as ElementCompact)._cdata = val;\n    }\n\n    /**\n     * 取得屬性文字內容。\n     */\n    public getAttr(name: string) {\n        this.checkNotArray();\n\n        const { _attributes = {} } = this.data as ElementCompact;\n        return _attributes[name] + '';\n    }\n\n    /** 設定屬性文字內容。 */\n    public setAttr(name: string, val: string) {\n        this.checkNotArray();\n\n        const data = this.data as ElementCompact\n        let { _attributes } = data;\n        if (!_attributes) {\n            _attributes = data._attributes = {};\n        }\n        _attributes[name] = val;\n        return this;\n    }\n\n    /** 取得子節點物件。 */\n    public child(...name: string[]) {\n        let parent: ElementCompact = this.data;\n        let child: XElement;\n\n        for (const n of name) {\n            child = this.getChild(n, parent);\n            parent = child.data;\n        }\n\n        return child!;\n    }\n\n    /**\n     * 取得子節點陣列。\n     *\n     * @param {string} name 子節點陣列名稱。\n     * @param {boolean} [autoConvert=false] 是否自動轉換為陣列，如果不是會自動轉換為陣列。\n     * 當值是 false 時，子節點非陣列會 Throw Error，預設為 true。\n     * @returns 子節點陣列。\n     * @memberof Jsonx\n     */\n    public children(name: string, autoConvert: boolean = true) {\n        let children = this.data[name];\n\n        if(children) {\n            if (autoConvert) {\n                if(!Array.isArray(children)) {\n                    children = this.data[name] = [children];\n                }\n            }\n\n            this.checkIsArray(children);\n            return new XElement(children);\n        } else {\n            this.data[name] = [];\n            return new XElement(this.data[name]);\n        }\n    }\n\n    /** 移除子節點，包含陣列結構。 */\n    public remove(name: string) {\n        if (!this.exists(name)) { return; }\n\n        delete this.data[name];\n    }\n\n    /**\n     * 提供寫入未處理的內容。\n     *\n     * @param {string} name 子節點名稱。\n     * @param {(string | XElement | any)} content Xml 字串、Jsonx 物件、一般物件。\n     * @memberof Jsonx\n     */\n    public raw(name: string, content: string | XElement | any) {\n\n        if(typeof(content) === 'string') {\n            const r = XElement.parse(content);\n\n            this.data[name] = r.data;\n        } else if (content instanceof XElement) {\n            this.data[name] = content.data;\n        } else {\n            this.data[name] = content;\n        }\n    }\n\n    // 如果不是陣列的話，會包裝成只有一個元素的 Iterator。\n    [Symbol.iterator](): Iterator<XElement> {\n        if(Array.isArray(this.data)) {\n            return Array.from(this.data)\n            .map(v => new XElement(v))\n            .values()\n        } else {\n            return [].concat(this.data)\n            .map(v => new XElement(v))\n            .values();\n        }\n    }\n\n    /** 在目前的陣列上建立一個新元素。 */\n    public new() {\n        this.checkIsArray(this.data);\n\n        const newnode = {};\n        this.data.push(newnode);\n        return new XElement(newnode);\n    }\n\n    public exists(...name: string[]) {\n\n        if (!!!this.data) { return false; }\n\n        let parent: ElementCompact = this.data;\n        let child: ElementCompact;\n\n        for (const n of name) {\n            child = parent[n];\n\n            if (!!!child) { return false; }\n\n            parent = child;\n        }\n\n        return !!child!;\n    }\n\n    /** 轉換成 Xml 字串格式。 */\n    public toXmlString(rootName?: string) {\n        return toXml(this.data, rootName);\n    }\n\n    // 是否為陣列，不是的話就 Throw Error，沒有傳參數代表判斷物件自身。\n    private checkIsArray(elm: any = this.data) {\n        if (!Array.isArray(elm)) {\n            throw new Error(`只有陣列節點才以進行此操作。`);\n        }\n    }\n\n    // 必需不是陣列，是的話就 Throw Error，沒有傳參數代表判斷物件自身。\n    private checkNotArray(elm: any = this.data) {\n        if (Array.isArray(elm)) {\n            throw new Error(`陣列不可進行此操作。`);\n        }\n    }\n\n    private getChild(childName: string, parent: ElementCompact) {\n        const child = parent[childName];\n        if (child) {\n            this.checkNotArray();\n            return new XElement(child);\n        } else {\n            parent[childName] = {};\n            return new XElement(parent[childName]);\n        }\n    }\n}\n","module.exports = require(\"crypto\");","module.exports = require(\"got\");","module.exports = require(\"xml-js\");"],"sourceRoot":""}